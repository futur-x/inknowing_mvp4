一、普通用户完整使用流程
用户故事1：小王的首次学习体验（问题驱动型）
背景：小王是一名产品经理，想了解如何提升团队管理能力
1. 进入首页
- URL: inknowing.ai
- 页面展示： 
  - 顶部：InKnowing Logo + "知识，从对话开始"标语
  - 中央：大号搜索框，占位符文字"问一个问题，找到能回答的书..."
  - 搜索框下方：热门问题标签（可点击）："如何管理团队" "怎样提高效率" "职场沟通技巧"
  - 底部：热门书籍网格（3x2），显示封面、书名、对话次数
  - 右上角：登录/注册按钮
2. 搜索问题
- 用户操作：在搜索框输入"如何激励团队成员"，按回车
- 页面响应： 
  - 加载动画（1-2秒）
  - 跳转到搜索结果页 /search?q=如何激励团队成员
- 结果页展示：
  为您找到 5 本相关书籍：
  
  [书籍卡片1]
  《驱动力》- 丹尼尔·平克
  匹配度：95%
  相关章节：第3章讨论内在动机激励...
  [开始对话] [查看详情]
  
  [书籍卡片2] 
  《管理的实践》- 德鲁克
  匹配度：88%
  相关章节：第7章论述目标管理与激励...
  [开始对话] [查看详情]
3. 开始对话
- 用户操作：点击《驱动力》的"开始对话"按钮
- 系统判断：检测用户未登录，但未达到试用限制
- 页面跳转：进入对话页面 /chat/book/{book_id}
- 页面布局： 
  - 左侧边栏（桌面端）/顶部标签（移动端）： 
    - 书籍封面缩略图
    - 书名和作者
    - 切换到"角色对话"选项
    - 历史会话列表（当前为空）
  - 中央对话区： 
    - 顶部提示条："您正在试用，剩余4次对话机会 [立即注册]"
    - 欢迎消息："我是《驱动力》的智能助手，您想了解关于团队激励的哪些内容？"
    - 底部输入框
4. 进行对话
- 用户输入："为什么金钱激励有时候反而降低员工积极性？"
- 系统处理： 
  - 输入框显示发送中状态（禁用）
  - 对话区显示"AI正在思考..."（带动画）
  - 2-3秒后显示完整回答
- AI回答展示：
  这是一个很有洞察力的问题。丹尼尔·平克在书中提出了"激励3.0"理论：
  
  外在奖励（如金钱）可能产生"挤出效应"，原因包括：
  
  1. 破坏内在动机 [引用: 第2章 P.47]
  "当人们因为外部奖励而做事时，会削弱他们对这件事本身的兴趣..."
  
  2. 降低创造力 [引用: 第3章 P.89]  
  "研究表明，当创造性任务与金钱奖励挂钩时，人们倾向于选择最简单的解决方案..."
  
  [查看原文] [分享这段对话]
5. 达到试用限制
- 场景：小王进行了5次对话后，输入第6个问题
- 系统响应： 
  - 弹出模态框：
    试用次数已用完
    
    注册即可：
    ✓ 每天20次免费对话
    ✓ 保存所有对话记录
    ✓ 个性化推荐
    
    [微信一键登录] [手机号注册]
    [稍后再说]
6. 注册登录
- 用户操作：点击"微信一键登录"
- 流程： 
  1. 跳转微信授权页面
  2. 用户确认授权
  3. 返回InKnowing，显示"登录成功"提示
  4. 自动回到之前的对话页面
  5. 试用期的5次对话记录自动保存到账户
用户故事2：李梅的深度阅读体验（书籍驱动型）
背景：李梅是文学爱好者，想深入了解《百年孤独》
7. 直接搜索书籍
- 页面：首页 inknowing.ai
- 操作：在搜索框输入"百年孤独"
- 结果：直接显示书籍详情卡片
  《百年孤独》
  加西亚·马尔克斯
  
  [与书对话] [与角色对话]
  
  可对话角色：
  • 乌尔苏拉
  • 奥雷里亚诺上校
  • 梅尔基亚德斯
8. 角色对话模式
- 用户操作：点击"与奥雷里亚诺上校对话"
- 页面切换：进入角色对话模式 /chat/character/{character_id}
- 界面变化： 
  - 背景色调整为淡黄色怀旧风格
  - 头像显示为角色形象（AI生成）
  - 开场白："我是奥雷里亚诺·布恩迪亚上校，经历过32场战争..."
9. 沉浸式对话
- 用户："上校，您为什么要发动那么多战争？"
- 角色回答（保持角色性格）：
  [语气：沉重而疲惫]
  
  年轻人，当你看到不公正横行，看到人民被压迫...起初，
  我以为战争能改变一切。但打到后来，我已经分不清是为了
  理想还是为了战争本身... 
  
  [引用: 第9章 P.234]
  "他发动战争是因为绝望，继续战争是因为孤独..."
  
  那32场战争，每一场都让我更加明白马孔多的宿命。
用户故事3：赵峰的付费升级流程
背景：免费用户赵峰每天20次对话不够用
10. 触发付费提醒
- 场景：当天第20次对话后
- 提示：
  今日免费额度已用完
  升级会员，畅享更多对话
  
  [查看会员权益] [明天再来]
11. 会员页面
- URL：inknowing.ai/membership
- 页面展示：
  选择适合您的会员计划
  
  [基础会员]        [高级会员]       [超级会员]
  ¥49/月           ¥99/月          ¥199/月
  200次/月         500次/月        1000次/月
  标准模型         高级模型         最强模型
  -              书籍5折优惠       免费书籍
                                  专属客服
  
  [立即开通]       [立即开通]       [立即开通]
12. 支付流程
- 选择：点击"高级会员-立即开通"
- 确认页：
  订单确认
  商品：高级会员（月度）
  价格：¥99.00
  
  支付方式：
  [✓] 微信支付
  [ ] 支付宝
  
  [确认支付]
- 支付：调起微信支付 → 完成支付
- 结果：返回成功页，显示"会员开通成功，额度已更新为500次"
用户故事4：王磊上传个人收藏书籍
背景：王磊想了解《掌控习惯》，但平台还没有这本书
13. 搜索无结果
- 用户操作：在首页搜索"掌控习惯"
- 搜索结果页：
  未找到《掌控习惯》
  
  想第一个和这本书对话吗？
  [立即上传这本书]
  
  或看看类似书籍：
  - 《习惯的力量》
  - 《微习惯》
14. 进入上传页面
- 点击："立即上传这本书"
- 权限检查： 
  - 未登录 → 提示登录
  - 已登录 → 进入上传页面 inknowing.ai/upload
- 上传页面展示：
  上传书籍，与更多人分享知识
  
  上传须知：
  • 支持TXT、PDF格式（限10MB）
  • 请确保您有权分享此内容
  • 上传后其他用户也可以对话
  • 您将获得100积分奖励
  
  [选择文件] 或拖拽文件到此处
15. 文件上传流程
- 用户操作：选择本地的"掌控习惯.txt"文件
- 文件检测：
  文件检测中...
  ✓ 格式正确
  ✓ 大小：1.8MB
  ✓ 编码：UTF-8
  
  请完善书籍信息：
  
  书名：[自动识别：掌控习惯]
  作者：[需要填写]
  分类：[下拉选择：自我提升/心理学/...]
  简介：[选填，最多200字]
  
  [开始处理]
16. AI智能处理
- 点击："开始处理"
- 处理步骤展示（实时更新）：
  智能处理中（预计需要2-3分钟）
  
  [✓] 检测AI是否已了解此书... AI未知，需要向量化
  [✓] 文本预处理...
  [✓] 智能分章节... 检测到12个章节
  [✓] 提取关键角色... 发现2个可对话角色
  [⚡] 向量化处理... 45%
  [ ] 创建知识索引...
  [ ] 生成对话模型...
  
  提取到的角色：
  • 詹姆斯·克利尔（作者视角）
  • 习惯教练（虚拟助手）
17. 处理完成
- 完成页面：
  🎉 上传成功！
  
  《掌控习惯》已可以对话
  
  书籍信息：
  - 12个章节
  - 2个可对话角色
  - 预计阅读时间：4小时
  
  您获得了100积分！
  
  [立即开始对话] [查看我的上传] [继续上传]
18. 上传书籍的特殊对话体验
- 进入对话：用户或其他人与上传的书对话
- 对话特点：
  用户："原子习惯是什么意思？"
  
  AI回答：
  根据这本书的内容，原子习惯是指微小的、易于执行的习惯改变：
  
  [📖 原文引用 - 第1章 P.15]
  "原子习惯是一个微小的习惯，它是更大系统的一部分。
  就像原子是分子的组成部分一样..."
  
  [📖 原文引用 - 第2章 P.28]  
  "每天改善1%，一年后你将变好37倍..."
  
  💡 这本书由用户@王磊分享
用户故事5：张霞查看和管理自己的上传
19. 个人中心
- 入口：点击头像 → "我的上传"
- 页面：inknowing.ai/profile/uploads
- 展示内容：
  我的上传书籍（3本）
  
  [书籍卡片1]
  《掌控习惯》
  上传时间：2024-01-15
  状态：✅ 已发布
  累计对话：234次
  获得积分：100
  [查看] [编辑信息] [下线]
  
  [书籍卡片2]
  《产品思维30讲》
  上传时间：2024-01-10
  状态：⏳ 处理中（预计5分钟）
  [查看进度]
二、管理员后台操作流程
管理员故事1：创建AI已知书籍
背景：管理员张总要添加《思考，快与慢》到平台
20. 登录后台
- URL：inknowing.ai/admin
- 登录：输入管理员账号密码
- 首页仪表盘：
  今日数据总览
  活跃用户：1,234
  对话总数：8,901  
  新增书籍：12
  API消耗：$45.67
  
  [书籍管理] [用户管理] [模型配置] [数据统计]
21. 创建书籍
- 操作：点击"书籍管理" → "添加书籍"
- 页面：inknowing.ai/admin/books/create
- 表单填写：
  书籍类型：[✓] AI已知书籍 [ ] 需要上传
  
  书名：思考，快与慢
  作者：丹尼尔·卡尼曼
  
  [检测AI是否了解]
22. AI检测与角色提取
- 点击："检测AI是否了解"
- 系统处理： 
  - 调用配置的LLM模型
  - 提示词："你了解《思考，快与慢》这本书吗？请列出主要章节和关键人物"
- 检测结果：
  ✅ AI模型了解此书
  
  检测到的内容：
  - 第一部分：系统1和系统2
  - 第二部分：启发式判断与偏见
  - 第三部分：过度自信
  ...
  
  自动识别的可对话角色：
  • 丹尼尔·卡尼曼（作者视角）
  • 理性思考者（系统2化身）
  • 直觉决策者（系统1化身）
  
  [确认创建] [编辑角色] [取消]
23. 完成创建
- 确认后： 
  - 自动抓取豆瓣封面图
  - 生成书籍ID
  - 创建默认角色配置
  - 状态设为"已发布"
- 成功提示："书籍创建成功，用户已可以开始对话"
管理员故事2：配置AI模型
24. 进入模型配置
- 路径：侧边栏 → "模型配置"
- 页面：inknowing.ai/admin/models
- 当前配置展示：
  语言模型配置
  
  主模型：
  提供商：OpenAI
  模型：gpt-4-turbo-preview
  API Key：sk-...xxxx (已配置)
  消耗：$234.56 本月
  
  [编辑] [添加备用模型]
25. 添加国内模型
- 操作：点击"添加备用模型"
- 配置表单：
  提供商：[下拉选择] 通义千问
  API Endpoint：https://dashscope.aliyuncs.com/api/v1/
  API Key：[输入框]
  模型版本：qwen-max
  
  参数设置：
  Temperature：0.7 [滑块]
  Max Tokens：2000 [输入]
  
  [测试连接] [保存配置]
26. 设置路由规则
- 场景配置：
  对话场景路由：
  
  普通对话：qwen-max（成本优先）
  角色扮演：gpt-4（效果优先）
  
  用户等级路由：
  免费用户：qwen-max
  付费用户：gpt-4-turbo
  
  [保存规则]
管理员故事3：处理用户上传书籍
27. 收到上传通知
- 通知："用户上传了新书籍《产品思维》，待审核"
- 进入审核：点击通知 → 跳转到 inknowing.ai/admin/books/review/{id}
28. 审核页面
- 展示内容：
  书籍信息：
  书名：产品思维
  上传者：用户李明
  文件大小：2.3MB
  格式：TXT
  
  内容预览：
  [显示前500字...]
  
  AI检测结果：
  [ ] AI已了解此书（无需向量化）
  [✓] AI不了解（需要向量化）
  
  AI角色识别结果：
  自动识别到3个主要角色：
  • 产品经理小明 - 案例主角
  • 技术总监老王 - 导师角色
  • CEO张总 - 决策者
  
  [通过并向量化] [拒绝] [需要修改]
29. 向量化处理
- 点击："通过并向量化"
- 处理流程：
  处理中...
  ✓ 文本分段（2,341段）
  ✓ 向量化处理（使用text-embedding-3-small）
  ✓ 存储到ChromaDB
  ✓ 创建索引
  ✓ 配置角色（3个）
  
  处理完成！书籍已上线
管理员故事4：配置书籍角色
背景：管理员需要为《红楼梦》配置可对话角色
30. 进入书籍详情管理
- 路径：管理后台 → 书籍管理 → 搜索"红楼梦"
- 书籍管理页：inknowing.ai/admin/books/{book_id}
- 页面展示：
  《红楼梦》管理页面
  
  基础信息：
  类型：AI已知书籍
  状态：已发布
  累计对话：10,234次
  
  [编辑信息] [角色管理] [对话统计] [下线书籍]
31. 角色管理页面
- 点击："角色管理"
- 页面：inknowing.ai/admin/books/{book_id}/characters
- 展示内容：
  智能识别的角色（AI自动提取）：
  
  [✅] 贾宝玉 - 主角，怡红公子
       自动生成的人设：多情、叛逆、厌恶功名
       对话次数：3,421次
       [编辑] [预览对话] [查看统计]
  
  [✅] 林黛玉 - 女主角，潇湘妃子  
       自动生成的人设：敏感、才华横溢、体弱多病
       对话次数：2,891次
       [编辑] [预览对话] [查看统计]
  
  [✅] 王熙凤 - 管家，凤辣子
       自动生成的人设：精明能干、泼辣、善于理财
       对话次数：1,002次
       [编辑] [预览对话] [查看统计]
  
  [ ] 薛宝钗 - 识别但未启用
  [ ] 贾母 - 识别但未启用
  
  [添加自定义角色] [批量启用] [重新识别]
32. 编辑角色详情
- 操作：点击贾宝玉的"编辑"
- 编辑页面：
  编辑角色：贾宝玉
  
  基础信息：
  角色名：贾宝玉
  别名：怡红公子、宝二爷
  
  人物设定（可编辑）：
  [文本框]
  性格：生性聪慧，却厌恶仕途经济，
  喜欢诗词歌赋。对女性充满尊重与欣赏，
  认为"女儿是水做的骨肉"...
  
  对话风格：
  语言特点：[下拉] 文雅/诗意/现代化解释
  情感基调：[下拉] 多愁善感/温柔/叛逆
  知识范围：[✓] 仅限书中内容 [ ] 可延伸解释
  
  关键记忆点（影响对话）：
  • 与林黛玉的木石前盟
  • 对功名利禄的反感
  • 大观园的生活经历
  [添加更多]
  
  对话示例：
  用户："宝玉，你为何不喜欢读书考功名？"
  预设回答："那些都是禄蠹之谈，我生平最恨这些..."
  
  [保存] [预览效果] [取消]
33. 预览角色对话
- 点击："预览效果"
- 弹出对话测试窗口：
  角色对话测试
  
  贾宝玉：我是怡红公子贾宝玉，在大观园中...
  
  [输入测试问题...]
  
  测试问题建议：
  • 你如何看待林妹妹？
  • 为什么写《芙蓉女儿诔》？
  • 你对金玉良缘的看法？
管理员故事5：监控与统计
34. 查看实时数据
- 页面：inknowing.ai/admin/dashboard
- 实时监控面板：
  实时监控（自动刷新）
  
  当前在线：342人
  进行中对话：128个
  
  热门书籍TOP5：
  1. 《原则》- 1,234次对话/今日
  2. 《人类简史》- 891次
  3. 《三体》- 756次
  
  API状态：
  OpenAI: ✅ 正常 (延迟 1.2s)
  通义千问: ✅ 正常 (延迟 0.8s)
  
  告警信息：
  ⚠️ 用户张三连续失败5次，请检查
35. 成本分析
- 点击："成本统计"
- 展示：
  本月API成本分析
  
  总消耗：¥3,456.78
  
  按模型：
  - GPT-4: ¥2,100.00 (60.8%)
  - 通义千问: ¥1,356.78 (39.2%)
  
  按功能：
  - 书籍对话: ¥2,500.00
  - 角色对话: ¥956.78
  
  成本趋势：[图表展示]
  预计月底：¥4,200.00
  
  [导出报表] [设置预算告警]
三、异常流程处理
场景1：API调用失败
- 用户操作：发送对话消息
- 系统检测：主模型API超时
- 自动处理： 
  1. 切换到备用模型
  2. 重试请求
  3. 如果成功，用户无感知
  4. 如果失败，显示："系统繁忙，请稍后重试"
场景2：支付失败
- 场景：用户支付时网络中断
- 页面提示：
  支付未完成
  
  如果您已完成支付但未到账，请联系客服
  微信客服：inknowing_service
  
  [重新支付] [联系客服]
场景3：书籍不存在
- 用户搜索："Flutter实战指南"
- 结果页：
  未找到《Flutter实战指南》
  
  您可以：
  1. 上传这本书与大家分享 [上传书籍]
  2. 看看相关推荐：
     - 《Flutter开发实战》
     - 《移动开发指南》
场景4：上传书籍失败
- 场景：用户上传的文件损坏
- 错误提示：
  文件处理失败
  
  可能的原因：
  • 文件编码不支持
  • 文件内容损坏
  • 格式不符合要求
  
  请检查文件后重试
  [重新上传] [联系客服]
场景5：角色对话异常
- 场景：角色人设配置错误
- 用户体验：角色回答不符合人设
- 处理： 
  1. 用户可点击"反馈问题"
  2. 管理员收到告警
  3. 后台调整角色配置
  4. 实时生效
四、完整数据流与系统架构
核心业务流程图
用户旅程主线：
发现(inknowing.ai) → 搜索(问题/书籍) → 对话(书籍/角色) 
→ 注册 → 深度使用 → 付费 → 分享传播

书籍创建流程：
1. AI已知书籍：
   管理员输入 → AI检测 → 自动提取角色 → 配置上线

2. 用户上传书籍：
   用户上传 → AI检测 → 向量化处理 → 角色识别 
   → 管理员审核 → 上线

对话处理流程：
用户输入 → 路由判断(书籍类型) → 
├─ AI书籍：直接生成 + 溯源标注
└─ 向量书籍：检索 + 生成 + 溯源标注
→ 返回结果 → 记录到Profile
页面URL结构
主站：inknowing.ai
├── / (首页)
├── /search (搜索结果)
├── /chat
│   ├── /book/{id} (书籍对话)
│   └── /character/{id} (角色对话)
├── /upload (上传书籍)
├── /profile
│   ├── /uploads (我的上传)
│   ├── /history (对话历史)
│   └── /settings (个人设置)
├── /membership (会员中心)
└── /admin (管理后台)
    ├── /dashboard (仪表盘)
    ├── /books (书籍管理)
    ├── /models (模型配置)
    └── /users (用户管理)

五、技术架构：
前端
- 框架：React/Next.js
- UI库：shadcn/ui（使用Yellow主题色）
- 样式系统： 
  - 主色调：Yellow主题（amber-500作为主色）
  - 设计风格：现代简洁，卡片式布局
  - 响应式：移动优先设计
- 状态管理：Zustand
- 样式：TailwindCSS（shadcn/ui基础）
后端
- 框架：FastAPI（Python）
- 数据库： 
  - PostgreSQL（业务数据）
  - Redis（缓存、会话）
  - ChromaDB（向量存储）
- 消息队列：RabbitMQ（异步任务）
- 配置中心：Nacos（模型配置管理）
AI服务层
- 模型网关：统一的模型调用接口
- 语言模型：可配置多种LLM（OpenAI/国内大模型）
- 向量模型：可配置多种Embedding（OpenAI/BGE/M3E）
- RAG框架：LangChain（支持多模型切换）
六、UI设计规范
色彩系统（基于shadcn/ui Yellow主题）
- 主色：amber-500 (#f59e0b) - 用于主要操作按钮、活跃状态
- 主色变体： 
  - amber-50 到 amber-900 渐变色阶
  - hover状态：amber-600
  - 禁用状态：amber-300
- 中性色：slate色系用于文本和边框
- 背景：白色主背景，amber-50作为强调背景
组件样式
- 按钮：使用shadcn/ui Button组件的yellow变体
- 卡片：圆角卡片带细微阴影
- 输入框：focus时显示amber边框
- 对话界面： 
  - 用户消息：右对齐，amber-100背景
  - AI回答：左对齐，白色背景带边框
  - 溯源标注：amber-500文字，可点击展开