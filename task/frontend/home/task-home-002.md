# Task-HOME-002: æœç´¢ç»“æœé¡µå¼€å‘

## ä»»åŠ¡ä¿¡æ¯
- **Task ID**: HOME-002
- **Title**: å®ç°æœç´¢ç»“æœé¡µé¢
- **Priority**: P0
- **Estimated Hours**: 5-6å°æ—¶
- **Dependencies**: HOME-001, BASE-002

## UI/UXéœ€æ±‚
### é¡µé¢å¸ƒå±€ï¼ˆåŸºäºdevDocument.mdç¬¬12-30è¡Œï¼‰
```
æœç´¢ç»“æœé¡µå¸ƒå±€ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Header + æœç´¢æ¡† (å›ºå®šé¡¶éƒ¨)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ğŸ” å¦‚ä½•æ¿€åŠ±å›¢é˜Ÿæˆå‘˜              [Ã—]  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚
â”‚  Results Header                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ ä¸ºæ‚¨æ‰¾åˆ° 5 æœ¬ç›¸å…³ä¹¦ç±                  â”‚â”‚
â”‚  â”‚ æŒ‰ç›¸å…³åº¦æ’åº [ä¸‹æ‹‰é€‰æ‹©]                â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚
â”‚  Search Results                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ [Book Card 1]                         â”‚â”‚
â”‚  â”‚ ã€Šé©±åŠ¨åŠ›ã€‹- ä¸¹å°¼å°”Â·å¹³å…‹                â”‚â”‚
â”‚  â”‚ åŒ¹é…åº¦ï¼š95%                           â”‚â”‚
â”‚  â”‚ ç›¸å…³ç« èŠ‚ï¼šç¬¬3ç« è®¨è®ºå†…åœ¨åŠ¨æœºæ¿€åŠ±...    â”‚â”‚
â”‚  â”‚ [å¼€å§‹å¯¹è¯] [æŸ¥çœ‹è¯¦æƒ…]                â”‚â”‚
â”‚  â”‚                                        â”‚â”‚
â”‚  â”‚ [Book Card 2]                         â”‚â”‚
â”‚  â”‚ ã€Šç®¡ç†çš„å®è·µã€‹- å¾·é²å…‹                â”‚â”‚
â”‚  â”‚ åŒ¹é…åº¦ï¼š88%                           â”‚â”‚
â”‚  â”‚ ...                                    â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                          â”‚
â”‚  No Results Fallback                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚ æœªæ‰¾åˆ°ã€ŠæŒæ§ä¹ æƒ¯ã€‹                     â”‚â”‚
â”‚  â”‚ æƒ³ç¬¬ä¸€ä¸ªå’Œè¿™æœ¬ä¹¦å¯¹è¯å—ï¼Ÿ               â”‚â”‚
â”‚  â”‚ [ç«‹å³ä¸Šä¼ è¿™æœ¬ä¹¦]                       â”‚â”‚
â”‚  â”‚ æˆ–çœ‹çœ‹ç±»ä¼¼ä¹¦ç±...                      â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è§†è§‰è®¾è®¡è¦æ±‚
- ä¿æŒæœç´¢æ¡†åœ¨é¡¶éƒ¨å›ºå®šä½ç½®
- ç»“æœå¡ç‰‡ä½¿ç”¨å¡ç‰‡å¼è®¾è®¡ï¼Œamberè¾¹æ¡†é«˜äº®
- åŒ¹é…åº¦ä½¿ç”¨è¿›åº¦æ¡æˆ–ç™¾åˆ†æ¯”å±•ç¤º
- ç©ºç»“æœé¡µé¢å¼•å¯¼ç”¨æˆ·ä¸Šä¼ ä¹¦ç±
- åŠ è½½çŠ¶æ€ä½¿ç”¨éª¨æ¶å±åŠ¨ç”»

## æŠ€æœ¯éœ€æ±‚
### é¡µé¢è·¯ç”±
```typescript
// app/search/page.tsx
interface SearchPageProps {
  searchParams: {
    q: string;          // æœç´¢å…³é”®è¯
    type?: 'book' | 'question';  // æœç´¢ç±»å‹
    sort?: 'relevance' | 'rating' | 'recent';  // æ’åºæ–¹å¼
    page?: string;      // åˆ†é¡µ
  };
}
```

### æœç´¢ç»“æœç»„ä»¶
```typescript
interface SearchResultsProps {
  query: string;
  results: SearchResult[];
  totalCount: number;
  loading?: boolean;
  error?: string;
}

interface SearchResult {
  id: string;
  title: string;
  author: string;
  cover: string;
  matchScore: number;  // åŒ¹é…åº¦ 0-100
  relevantChapter?: string;  // ç›¸å…³ç« èŠ‚
  description: string;
  dialogueCount: number;
  rating: number;
  tags: string[];
}

const SearchResults: React.FC<SearchResultsProps> = ({
  query,
  results,
  totalCount,
  loading,
  error
}) => {
  // å®ç°è¦ç‚¹ï¼š
  // - æœç´¢è¯é«˜äº®
  // - ç›¸å…³ç« èŠ‚æ‘˜è¦
  // - åˆ†é¡µæˆ–æ— é™æ»šåŠ¨
  // - æ’åºé€‰é¡¹
};
```

### æœç´¢APIé›†æˆ
```typescript
// hooks/useSearch.ts
interface UseSearchParams {
  query: string;
  type: 'book' | 'question';
  sort: string;
  page: number;
}

const useSearch = ({ query, type, sort, page }: UseSearchParams) => {
  return useSWR(
    query ? ['search', query, type, sort, page] : null,
    () => searchAPI.search({
      q: query,
      type,
      sort,
      limit: 10,
      offset: (page - 1) * 10
    }),
    {
      keepPreviousData: true,
      revalidateOnFocus: false
    }
  );
};

// APIè°ƒç”¨ - åŸºäºapi-specification.yaml
const searchAPI = {
  search: async (params: SearchParams) => {
    // GET /search?q={query}&type={type}&sort={sort}
    return api.get('/search', { params });
  },

  getSuggestions: async (query: string) => {
    // GET /search/suggestions?q={query}
    return api.get('/search/suggestions', {
      params: { q: query }
    });
  }
};
```

### çŠ¶æ€ç®¡ç†
```typescript
// stores/search-store.ts
interface SearchStore {
  currentQuery: string;
  searchHistory: string[];
  results: SearchResult[];
  totalCount: number;
  currentPage: number;
  sortBy: 'relevance' | 'rating' | 'recent';
  loading: boolean;
  error: string | null;

  // Actions
  setQuery: (query: string) => void;
  search: (query: string) => Promise<void>;
  loadMore: () => Promise<void>;
  setSortBy: (sort: string) => void;
  addToHistory: (query: string) => void;
  clearResults: () => void;
}
```

## ç»„ä»¶è§„èŒƒ
### SearchBarç»„ä»¶ï¼ˆé¡¶éƒ¨å›ºå®šï¼‰
```typescript
interface SearchBarProps {
  initialQuery?: string;
  onSearch: (query: string) => void;
  showSuggestions?: boolean;
}

// åŠŸèƒ½ï¼š
// - å›ºå®šåœ¨é¡µé¢é¡¶éƒ¨
// - ä¿æŒä¹‹å‰çš„æœç´¢è¯
// - æ”¯æŒä¿®æ”¹æœç´¢é‡æ–°æŸ¥è¯¢
// - æ¸…é™¤æŒ‰é’®
```

### SearchResultCardç»„ä»¶
```typescript
interface SearchResultCardProps {
  result: SearchResult;
  query: string;  // ç”¨äºé«˜äº®æœç´¢è¯
  onStartChat: (bookId: string) => void;
  onViewDetail: (bookId: string) => void;
}

// è®¾è®¡è¦ç‚¹ï¼š
// - ä¹¦ç±å°é¢ (å·¦ä¾§)
// - æ ‡é¢˜å’Œä½œè€… (é«˜äº®æœç´¢è¯)
// - åŒ¹é…åº¦è¿›åº¦æ¡
// - ç›¸å…³ç« èŠ‚æ‘˜è¦
// - æ“ä½œæŒ‰é’®åŒºåŸŸ
```

### NoResultsç»„ä»¶
```typescript
interface NoResultsProps {
  query: string;
  onUploadSuggestion: () => void;
  suggestedBooks?: Book[];
}

// åŠŸèƒ½ï¼š
// - æœªæ‰¾åˆ°ç»“æœæç¤º
// - å»ºè®®ä¸Šä¼ ä¹¦ç±
// - æ˜¾ç¤ºç›¸ä¼¼ä¹¦ç±æ¨è
// - æœç´¢å»ºè®®
```

### SearchFiltersç»„ä»¶
```typescript
interface SearchFiltersProps {
  sortBy: string;
  onSortChange: (sort: string) => void;
  totalCount: number;
}

// åŒ…å«ï¼š
// - æ’åºé€‰æ‹©å™¨
// - ç»“æœæ•°é‡æ˜¾ç¤º
// - ç­›é€‰é€‰é¡¹ï¼ˆé¢„ç•™ï¼‰
```

### LoadingSkeletonç»„ä»¶
```typescript
const SearchResultSkeleton = () => {
  // æœç´¢ç»“æœéª¨æ¶å±
  // æ¨¡æ‹Ÿå¡ç‰‡å¸ƒå±€
  // ä½¿ç”¨shimmeråŠ¨ç”»
};
```

## éªŒæ”¶æ ‡å‡†
### åŠŸèƒ½è¦æ±‚
- [ ] URLå‚æ•°æ­£ç¡®è§£ææœç´¢è¯
- [ ] æœç´¢ç»“æœæ­£ç¡®å±•ç¤º
- [ ] åŒ¹é…åº¦è®¡ç®—å’Œæ˜¾ç¤º
- [ ] æ’åºåŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] åˆ†é¡µæˆ–æ— é™æ»šåŠ¨
- [ ] æ— ç»“æœæ—¶æ˜¾ç¤ºä¸Šä¼ å¼•å¯¼

### æ€§èƒ½è¦æ±‚
- [ ] æœç´¢å“åº”æ—¶é—´ < 1ç§’
- [ ] ç»“æœåˆ—è¡¨è™šæ‹ŸåŒ–ï¼ˆå¤§é‡ç»“æœæ—¶ï¼‰
- [ ] å›¾ç‰‡æ‡’åŠ è½½
- [ ] æœç´¢é˜²æŠ–å’Œç¼“å­˜

### ç”¨æˆ·ä½“éªŒ
- [ ] æœç´¢è¯é«˜äº®æ˜¾ç¤º
- [ ] åŠ è½½çŠ¶æ€å‹å¥½
- [ ] é”™è¯¯æç¤ºæ¸…æ™°
- [ ] å¿«é€Ÿå†æ¬¡æœç´¢

## æµ‹è¯•ç”¨ä¾‹
### å•å…ƒæµ‹è¯•
```typescript
describe('SearchResults', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“æœç´¢ç»“æœ', () => {
    // æµ‹è¯•ç»“æœåˆ—è¡¨æ¸²æŸ“
  });

  it('åº”è¯¥é«˜äº®æœç´¢å…³é”®è¯', () => {
    // æµ‹è¯•å…³é”®è¯é«˜äº®
  });

  it('åº”è¯¥å¤„ç†ç©ºç»“æœ', () => {
    // æµ‹è¯•æ— ç»“æœçŠ¶æ€
  });

  it('åº”è¯¥æ”¯æŒæ’åºåˆ‡æ¢', () => {
    // æµ‹è¯•æ’åºåŠŸèƒ½
  });
});
```

### E2Eæµ‹è¯•
```typescript
describe('Search Flow', () => {
  it('å®Œæ•´æœç´¢æµç¨‹', () => {
    // 1. ä»é¦–é¡µè¿›å…¥æœç´¢
    // 2. æŸ¥çœ‹æœç´¢ç»“æœ
    // 3. åˆ‡æ¢æ’åºæ–¹å¼
    // 4. ç‚¹å‡»å¼€å§‹å¯¹è¯
    // 5. è·³è½¬å¯¹è¯é¡µé¢
  });

  it('æœç´¢æ— ç»“æœæµç¨‹', () => {
    // 1. æœç´¢ä¸å­˜åœ¨çš„ä¹¦
    // 2. æŸ¥çœ‹æ— ç»“æœé¡µé¢
    // 3. ç‚¹å‡»ä¸Šä¼ å»ºè®®
    // 4. è·³è½¬ä¸Šä¼ é¡µé¢
  });
});
```

## å®æ–½æ­¥éª¤
1. åˆ›å»ºæœç´¢ç»“æœé¡µè·¯ç”±
2. å®ç°SearchBarç»„ä»¶
3. å¼€å‘SearchResultCardç»„ä»¶
4. å®ç°æœç´¢APIé›†æˆ
5. æ·»åŠ æ’åºå’Œç­›é€‰åŠŸèƒ½
6. å¼€å‘NoResultsç»„ä»¶
7. å®ç°åŠ è½½çŠ¶æ€
8. æ·»åŠ æœç´¢å†å²åŠŸèƒ½
9. æ€§èƒ½ä¼˜åŒ–ï¼ˆè™šæ‹ŸåŒ–ã€ç¼“å­˜ï¼‰
10. å®Œæˆæµ‹è¯•ç”¨ä¾‹

## æœç´¢ç®—æ³•æ˜ å°„
åŸºäºapi-specification.yamlçš„æœç´¢å‚æ•°ï¼š

| å‰ç«¯å‚æ•° | APIå‚æ•° | è¯´æ˜ |
|---------|---------|------|
| query | q | æœç´¢å…³é”®è¯ |
| type | type | book/questionç±»å‹ |
| sort | sort_by | relevance/rating/recent |
| page | offset/limit | åˆ†é¡µå‚æ•° |

## ç›¸å…³æ–‡æ¡£å¼•ç”¨
- devDocument.md: ç¬¬12-30è¡Œï¼ˆæœç´¢ç»“æœé¡µï¼‰
- devDocument.md: ç¬¬157-167è¡Œï¼ˆæ— ç»“æœçŠ¶æ€ï¼‰
- api-specification.yaml: æœç´¢ç›¸å…³API
- user-journey-diagram.md: ç¬¬51-58è¡Œï¼ˆæœç´¢å‘ç°æµç¨‹ï¼‰